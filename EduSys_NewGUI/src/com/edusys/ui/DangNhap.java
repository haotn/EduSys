/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package com.edusys.ui;

import com.edusys.dao.NhanVienDAO;
import com.edusys.dao.UserDAO;
import com.edusys.entity.NhanVien;
import com.edusys.entity.User;
import com.edusys.helper.Auth;
import static com.edusys.helper.MsgBox.alert;
import static com.edusys.helper.MsgBox.confirm;
import java.awt.Color;
import java.awt.event.KeyEvent;
import java.util.List;
import javax.swing.ImageIcon;
import javax.swing.JOptionPane;
import javax.swing.UIManager;

/**
 *
 * @author haotn
 */
public class DangNhap extends javax.swing.JFrame {

    /**
     * Creates new form DangNhap
     */
    //static boolean isManager;
    boolean showPass = false;
    static String taiKhoan = Chao.taiKhoan;
    static String matKhau = Chao.matKhau;

    public DangNhap() {
        initComponents();
        setLocationRelativeTo(null);
        setResizable(false);
        chkNhoMatKhau.setBackground(new Color(0, 0, 0, 1));
        chkHienMatKhau.setBackground(new Color(0, 0, 0, 1));
        pwdPass.setEchoChar('\u25cf');
        getTaiKhoan();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        close = new javax.swing.JLabel();
        lblAn_Hien = new javax.swing.JLabel();
        left = new javax.swing.JPanel();
        Wellcome = new javax.swing.JLabel();
        EduSys = new javax.swing.JLabel();
        src = new javax.swing.JLabel();
        aut = new javax.swing.JLabel();
        backgroundLeft = new javax.swing.JLabel();
        right = new javax.swing.JPanel();
        Title = new javax.swing.JLabel();
        txtUser = new javax.swing.JTextField();
        lblTaiKhoan = new javax.swing.JLabel();
        lblTaiKhoan1 = new javax.swing.JLabel();
        btnDangNhap = new javax.swing.JButton();
        jSeparator1 = new javax.swing.JSeparator();
        pwdPass = new javax.swing.JPasswordField();
        jSeparator2 = new javax.swing.JSeparator();
        chkNhoMatKhau = new javax.swing.JCheckBox();
        lblQuenMatKhau = new javax.swing.JLabel();
        chkHienMatKhau = new javax.swing.JCheckBox();
        backgroundRight = new javax.swing.JLabel();

        close.setIcon(new javax.swing.ImageIcon(getClass().getResource("/com/edusys/images/BlackClose.png"))); // NOI18N

        lblAn_Hien.setForeground(new java.awt.Color(255, 255, 255));
        lblAn_Hien.setIcon(new javax.swing.ImageIcon(getClass().getResource("/com/edusys/images/HienMatKhau.png"))); // NOI18N
        lblAn_Hien.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                lblAn_HienMouseClicked(evt);
            }
            public void mousePressed(java.awt.event.MouseEvent evt) {
                lblAn_HienMousePressed(evt);
            }
        });

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
        setTitle("EduSys - Đăng nhập");
        setUndecorated(true);
        getContentPane().setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        left.setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        Wellcome.setFont(new java.awt.Font("SansSerif", 1, 18)); // NOI18N
        Wellcome.setForeground(new java.awt.Color(255, 255, 255));
        Wellcome.setText("Wellcome to");
        left.add(Wellcome, new org.netbeans.lib.awtextra.AbsoluteConstraints(120, 140, -1, -1));

        EduSys.setFont(new java.awt.Font("Showcard Gothic", 1, 36)); // NOI18N
        EduSys.setForeground(new java.awt.Color(255, 255, 255));
        EduSys.setText("EduSys");
        left.add(EduSys, new org.netbeans.lib.awtextra.AbsoluteConstraints(100, 170, -1, -1));

        src.setFont(new java.awt.Font("Arial", 0, 14)); // NOI18N
        src.setForeground(new java.awt.Color(255, 255, 255));
        src.setText("CoppyRight ©");
        left.add(src, new org.netbeans.lib.awtextra.AbsoluteConstraints(70, 370, -1, -1));

        aut.setFont(new java.awt.Font("Arial", 1, 18)); // NOI18N
        aut.setForeground(new java.awt.Color(255, 255, 255));
        aut.setText("NHOM 5");
        left.add(aut, new org.netbeans.lib.awtextra.AbsoluteConstraints(170, 370, -1, -1));

        backgroundLeft.setIcon(new javax.swing.ImageIcon(getClass().getResource("/com/edusys/images/leftSignIn.png"))); // NOI18N
        left.add(backgroundLeft, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 0, 350, 400));

        getContentPane().add(left, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 0, 350, 400));

        right.setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        Title.setFont(new java.awt.Font("SansSerif", 1, 18)); // NOI18N
        Title.setForeground(new java.awt.Color(255, 255, 255));
        Title.setText("ĐĂNG NHẬP");
        right.add(Title, new org.netbeans.lib.awtextra.AbsoluteConstraints(120, 40, -1, -1));

        txtUser.setFont(new java.awt.Font("SansSerif", 1, 14)); // NOI18N
        txtUser.setBorder(javax.swing.BorderFactory.createEmptyBorder(0, 0, 0, 0));
        txtUser.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtUserActionPerformed(evt);
            }
        });
        right.add(txtUser, new org.netbeans.lib.awtextra.AbsoluteConstraints(40, 120, 270, 32));

        lblTaiKhoan.setFont(new java.awt.Font("SansSerif", 1, 14)); // NOI18N
        lblTaiKhoan.setForeground(new java.awt.Color(255, 255, 255));
        lblTaiKhoan.setText("Tài khoản");
        right.add(lblTaiKhoan, new org.netbeans.lib.awtextra.AbsoluteConstraints(30, 90, -1, -1));

        lblTaiKhoan1.setFont(new java.awt.Font("SansSerif", 1, 14)); // NOI18N
        lblTaiKhoan1.setForeground(new java.awt.Color(255, 255, 255));
        lblTaiKhoan1.setText("Mật khẩu");
        right.add(lblTaiKhoan1, new org.netbeans.lib.awtextra.AbsoluteConstraints(30, 170, -1, -1));

        btnDangNhap.setBackground(new java.awt.Color(255, 255, 255));
        btnDangNhap.setFont(new java.awt.Font("SansSerif", 1, 14)); // NOI18N
        btnDangNhap.setText("Đăng nhập");
        btnDangNhap.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnDangNhapActionPerformed(evt);
            }
        });
        right.add(btnDangNhap, new org.netbeans.lib.awtextra.AbsoluteConstraints(130, 340, -1, -1));
        right.add(jSeparator1, new org.netbeans.lib.awtextra.AbsoluteConstraints(40, 230, 240, 10));

        pwdPass.setFont(new java.awt.Font("SansSerif", 1, 14)); // NOI18N
        pwdPass.setBorder(javax.swing.BorderFactory.createEmptyBorder(0, 0, 0, 0));
        pwdPass.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                pwdPassActionPerformed(evt);
            }
        });
        pwdPass.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                pwdPassKeyPressed(evt);
            }
        });
        right.add(pwdPass, new org.netbeans.lib.awtextra.AbsoluteConstraints(40, 200, 270, 32));
        right.add(jSeparator2, new org.netbeans.lib.awtextra.AbsoluteConstraints(40, 150, 270, 10));

        chkNhoMatKhau.setBackground(new java.awt.Color(255, 255, 255));
        chkNhoMatKhau.setFont(new java.awt.Font("SansSerif", 1, 14)); // NOI18N
        chkNhoMatKhau.setForeground(new java.awt.Color(255, 255, 255));
        chkNhoMatKhau.setText("Nhớ mật khẩu");
        right.add(chkNhoMatKhau, new org.netbeans.lib.awtextra.AbsoluteConstraints(40, 290, -1, -1));

        lblQuenMatKhau.setFont(new java.awt.Font("SansSerif", 1, 14)); // NOI18N
        lblQuenMatKhau.setForeground(new java.awt.Color(255, 255, 255));
        lblQuenMatKhau.setText("Quên mật khẩu?");
        lblQuenMatKhau.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseEntered(java.awt.event.MouseEvent evt) {
                lblQuenMatKhauMouseEntered(evt);
            }
            public void mouseExited(java.awt.event.MouseEvent evt) {
                lblQuenMatKhauMouseExited(evt);
            }
            public void mousePressed(java.awt.event.MouseEvent evt) {
                lblQuenMatKhauMousePressed(evt);
            }
        });
        right.add(lblQuenMatKhau, new org.netbeans.lib.awtextra.AbsoluteConstraints(200, 290, -1, 30));

        chkHienMatKhau.setBackground(new java.awt.Color(255, 255, 255));
        chkHienMatKhau.setFont(new java.awt.Font("SansSerif", 1, 14)); // NOI18N
        chkHienMatKhau.setForeground(new java.awt.Color(255, 255, 255));
        chkHienMatKhau.setText("Hiện mật khẩu");
        chkHienMatKhau.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                chkHienMatKhauActionPerformed(evt);
            }
        });
        right.add(chkHienMatKhau, new org.netbeans.lib.awtextra.AbsoluteConstraints(50, 240, -1, -1));

        backgroundRight.setIcon(new javax.swing.ImageIcon(getClass().getResource("/com/edusys/images/rightSignIn.png"))); // NOI18N
        right.add(backgroundRight, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 0, 350, 400));

        getContentPane().add(right, new org.netbeans.lib.awtextra.AbsoluteConstraints(350, 0, 350, 400));

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void pwdPassActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_pwdPassActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_pwdPassActionPerformed

    private void txtUserActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtUserActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_txtUserActionPerformed

    private void lblAn_HienMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_lblAn_HienMouseClicked
        // TODO add your handling code here:

    }//GEN-LAST:event_lblAn_HienMouseClicked

    private void btnDangNhapActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnDangNhapActionPerformed
        // TODO add your handling code here:
        if (kiemTra()) {
            dangNhap();
        }
    }//GEN-LAST:event_btnDangNhapActionPerformed

    private void pwdPassKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_pwdPassKeyPressed
        // TODO add your handling code here:
        if (evt.getKeyChar() == KeyEvent.VK_ENTER) {
            if (kiemTra()) {
                dangNhap();
            }
        }
    }//GEN-LAST:event_pwdPassKeyPressed

    private void lblAn_HienMousePressed(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_lblAn_HienMousePressed
        // TODO add your handling code here:
        if (showPass == false) {
            pwdPass.setEchoChar((char) 0);
            lblAn_Hien.setIcon(new ImageIcon("src/com/edusys/images/AnMatKhau.png"));
            showPass = true;
        } else {
            pwdPass.setEchoChar('*');
            lblAn_Hien.setIcon(new ImageIcon("src/com/edusys/images/HienMatKhau.png"));
            showPass = false;
        }
    }//GEN-LAST:event_lblAn_HienMousePressed

    private void lblQuenMatKhauMouseEntered(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_lblQuenMatKhauMouseEntered
        // TODO add your handling code here:
        lblQuenMatKhau.setForeground(Color.red);
    }//GEN-LAST:event_lblQuenMatKhauMouseEntered

    private void lblQuenMatKhauMouseExited(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_lblQuenMatKhauMouseExited
        // TODO add your handling code here:
        lblQuenMatKhau.setForeground(Color.white);
    }//GEN-LAST:event_lblQuenMatKhauMouseExited

    private void lblQuenMatKhauMousePressed(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_lblQuenMatKhauMousePressed
        // TODO add your handling code here:
        this.dispose();
        new QuenMatKhau().setVisible(true);
    }//GEN-LAST:event_lblQuenMatKhauMousePressed

    private void chkHienMatKhauActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_chkHienMatKhauActionPerformed
        // TODO add your handling code here:
        if (pwdPass.getEchoChar() == (char) 0) {
            pwdPass.setEchoChar('\u25cf');
        } else {
            pwdPass.setEchoChar((char) 0);
        }
    }//GEN-LAST:event_chkHienMatKhauActionPerformed

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(DangNhap.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(DangNhap.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(DangNhap.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(DangNhap.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                try {
                    org.jb2011.lnf.beautyeye.BeautyEyeLNFHelper.launchBeautyEyeLNF();
                    UIManager.put("RootPane.setupButtonVisible", false);
                } catch (Exception e) {
                    //TODO exception
                }
                new DangNhap().setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JLabel EduSys;
    private javax.swing.JLabel Title;
    private javax.swing.JLabel Wellcome;
    private javax.swing.JLabel aut;
    private javax.swing.JLabel backgroundLeft;
    private javax.swing.JLabel backgroundRight;
    private javax.swing.JButton btnDangNhap;
    private javax.swing.JCheckBox chkHienMatKhau;
    private javax.swing.JCheckBox chkNhoMatKhau;
    private javax.swing.JLabel close;
    private javax.swing.JSeparator jSeparator1;
    private javax.swing.JSeparator jSeparator2;
    private javax.swing.JLabel lblAn_Hien;
    private javax.swing.JLabel lblQuenMatKhau;
    private javax.swing.JLabel lblTaiKhoan;
    private javax.swing.JLabel lblTaiKhoan1;
    private javax.swing.JPanel left;
    private javax.swing.JPasswordField pwdPass;
    private javax.swing.JPanel right;
    private javax.swing.JLabel src;
    private javax.swing.JTextField txtUser;
    // End of variables declaration//GEN-END:variables

    NhanVienDAO dao = new NhanVienDAO();

    public boolean kiemTra() {
        if (txtUser.getText().equals("") && String.valueOf(pwdPass.getPassword()).equals("")) {
            alert(this, "Xin hãy nhập tên đăng nhập và mật khẩu.");
            txtUser.requestFocus();
            return false;
        } else if (txtUser.getText().equals("")) {
            alert(this, "Bạn chưa nhập tên đăng nhập.");
            txtUser.requestFocus();
        } else if (String.valueOf(pwdPass.getPassword()).equals("")) {
            alert(this, "Bạn chưa nhập mật khẩu.");
            pwdPass.requestFocus();
            return false;
        }
        return true;
    }

    public void dangNhap() {
        String tendangnhap = txtUser.getText();
        String matkhau = String.valueOf(pwdPass.getPassword());
        NhanVien nhanVien = dao.selectById(tendangnhap);
        if (nhanVien == null) {
            alert(this, "Tên đăng nhập không đúng.");
        } else if (!matkhau.equals(nhanVien.getMatKhau())) {
            alert(this, "Mật khẩu không đúng.");
        } else {
            Auth.user = nhanVien;
            luuTaiKhoan(Auth.user);
            this.dispose();
            new MainGUI().setVisible(true);

        }
    }

    public void getTaiKhoan() {
        if (taiKhoan != null && matKhau != null) {
            txtUser.setText(taiKhoan);
            pwdPass.setText(matKhau);
            //NhanVien nv = dao.selectById(taiKhoan);
            //Auth.user = Chao.user;
            chkNhoMatKhau.setSelected(true);
            //btnDangNhap.doClick();

            dispose();
        }
    }

    public void luuTaiKhoan(NhanVien nv) {
        UserDAO urDAO = new UserDAO();
        if (chkNhoMatKhau.isSelected() == true) {
            List<User> list = urDAO.selectAll();
            if (list.size() == 0) {
                User user = new User();
                user.setTaiKhoan(nv.getMaNV());
                user.setMatKhau(nv.getMatKhau());
                urDAO.insert(user);
            }
        } else {
            List<User> list = urDAO.selectAll();
            if (list.size() != 0) {
                urDAO.delete();
            }
        }
    }

    public void ketThuc() {
        if (confirm(this, "Bạn có muốn kết thúc ứng dụng?")) {
            System.exit(0);
        }
    }

}
